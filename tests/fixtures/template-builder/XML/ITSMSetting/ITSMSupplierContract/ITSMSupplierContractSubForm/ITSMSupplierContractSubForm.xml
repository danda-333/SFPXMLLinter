<?xml version="1.0" encoding="utf-8"?>
<Form xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:dsp="http://www.gappex.com/sfp/DataSource/Parameters" Ident="ITSMSupplierContractSubForm" IsSubForm="true" SegmentType="ITSMSettingSegment" PackageIdent="ITSMPackage">
	<DataPermissions>
    <string>ITSMSettingAdmin</string>
  </DataPermissions>
  <CreatePermissions>
    <string>ITSMSettingAdmin</string>
  </CreatePermissions>
	<Buttons>
		<Button xsi:type="FormButton" Ident="SaveButton" TitleResourceKey="SaveButton_ITSM" IsSave="true" PlacementType="Top Bottom" ColorType="Primary" IconCssClass="icon-floppy-disk" IsVisible="false" />

		<Button xsi:type="FormButton" Ident="DeleteButton" TitleResourceKey="DeleteButton_ITSM" IsSave="false" ColorType="Danger" PlacementType="Top Bottom" IsVisible="false" IconCssClass="icon-bin2">
			<Extensions>
				<Extension xsi:type="ConfirmDialogExtension" TitleResourceKey="DeleteDialogTitle_ITSM" DescriptionResourceKey="DeleteDialogDescription_ITSM" />
			</Extensions>
		</Button>
	</Buttons>
	<Controls>

		<Control xsi:type="HiddenControl" Ident="TableID" DataType="Number" />
		<Control xsi:type="HiddenControl" Ident="FormIdent" DataType="String" MaxLength="150" />

		<Control xsi:type="AutoCompleteControl" Ident="ServiceFolderTreeIdent" DataType="VarChar" MaxLength="900" TitleResourceKey="ServiceFolderTreeIdent_ITSM" IsReadOnly="true" IsRequired="true">
			<EmptyDataBind>
				<Columns>
					<Column Ident="Ident" DataBindType="Value" />
					<Column Ident="Name" DataBindType="Title" />
				</Columns>
				<SQL>
					SELECT TOP 20
            ft.Ident
						,STUFF(
							(
								SELECT ' → ' + ftv.FolderName
								FROM (
									SELECT TOP (LEN(ft.Ident) / 7)
									ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) AS n
									FROM sys.objects
								) x
								INNER JOIN dbo.FolderTreeView as ftv on ftv.Ident = LEFT(ft.Ident,(7*n))

								FOR XML PATH('')
						), 1, 3, '') AS Name
          FROM dbo.FolderTree as ft
          INNER JOIN dbo.Folder as f on f.ID = ft.FolderID AND f.[State] = @StateOne
          LEFT JOIN dbo.FolderTree as ftPar on ftPar.ID = ft.ParentFolderTreeID
          WHERE
            f.FolderGroupSegmentIdent = @FolderGroupSegmentIdent
						AND NOT EXISTS(
							SELECT NULL
							FROM dbo.FolderTree
							WHERE
								Ident LIKE ft.Ident + '%' AND Ident != ft.Ident
						)
          ORDER BY ft.Ident
				</SQL>
				<Parameters>
          <dsp:Parameter xsi:type="dsp:ValueParameter" Ident="StateOne" DataType="Number" Value="1" />
          <dsp:Parameter xsi:type="dsp:ValueParameter" Ident="FolderGroupSegmentIdent" DataType="String" MaxLength="50" Value="ITSMServiceFolderGroup" />
				</Parameters>
			</EmptyDataBind>
			<DataBind DefaultTitleResourceKey="SelectValue_ITSM">
				<Columns>
					<Column Ident="Ident" DataBindType="Value" />
					<Column Ident="Name" DataBindType="Title" />
				</Columns>
				<SQL>
					SELECT
            ft.Ident
						,STUFF(
							(
								SELECT ' → ' + ftv.FolderName
								FROM (
									SELECT TOP (LEN(ft.Ident) / 7)
									ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) AS n
									FROM sys.objects
								) x
								INNER JOIN dbo.FolderTreeView as ftv on ftv.Ident = LEFT(ft.Ident,(7*n))

								FOR XML PATH('')
						), 1, 3, '') AS Name
          FROM dbo.FolderTree as ft
          INNER JOIN dbo.Folder as f on f.ID = ft.FolderID AND f.[State] = @StateOne
          LEFT JOIN dbo.FolderTree as ftPar on ftPar.ID = ft.ParentFolderTreeID
          WHERE
            f.FolderGroupSegmentIdent = @FolderGroupSegmentIdent
						AND NOT EXISTS(
							SELECT NULL
							FROM dbo.FolderTree
							WHERE
								Ident LIKE ft.Ident + '%' AND Ident != ft.Ident
						)
						AND f.[Name] LIKE @ServiceFolderTreeIdent
          ORDER BY ft.Ident
				</SQL>
				<Parameters>
          <dsp:Parameter xsi:type="dsp:ValueParameter" Ident="StateOne" DataType="Number" Value="1" />
          <dsp:Parameter xsi:type="dsp:ValueParameter" Ident="FolderGroupSegmentIdent" DataType="String" MaxLength="50" Value="ITSMServiceFolderGroup" />
					<dsp:Parameter xsi:type="dsp:VariableParameter" Ident="ServiceFolderTreeIdent" DataType="String" MaxLength="200" LikeType="Both" />
				</Parameters>
			</DataBind>
			<SelectedDataBind>
				<Columns>
					<Column Ident="Ident" DataBindType="Value" />
					<Column Ident="Name" DataBindType="Title" />
				</Columns>
				<SQL>
					SELECT
            ft.Ident
						,STUFF(
							(
								SELECT ' → ' + ftv.FolderName
								FROM (
									SELECT TOP (LEN(ft.Ident) / 7)
									ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) AS n
									FROM sys.objects
								) x
								INNER JOIN dbo.FolderTreeView as ftv on ftv.Ident = LEFT(ft.Ident,(7*n))

								FOR XML PATH('')
						), 1, 3, '') AS Name
          FROM dbo.FolderTree as ft
          INNER JOIN dbo.Folder as f on f.ID = ft.FolderID
          WHERE
            f.FolderGroupSegmentIdent = @FolderGroupSegmentIdent
            AND ft.[Ident] = @ServiceFolderTreeIdent
				</SQL>
				<Parameters>
					<dsp:Parameter xsi:type="dsp:VariableParameter" Ident="ServiceFolderTreeIdent" DataType="VarChar" MaxLength="900" />
          <dsp:Parameter xsi:type="dsp:ValueParameter" Ident="FolderGroupSegmentIdent" DataType="String" MaxLength="50" Value="ITSMServiceFolderGroup" />
				</Parameters>
			</SelectedDataBind>
		</Control>

		<Control xsi:type="TextBoxControl" Ident="ServicePrice" DataType="Double" DataTypeSize="15,2" TitleResourceKey="ServicePrice_ITSM" IsReadOnly="true" />

	</Controls>
	<Sections>
		<Section xsi:type="ContentSection" Ident="BasicInformationSection" TitleResourceKey="BasicInformationSection_ITSM" IconCssClass="icon-bookmark">
			<HTMLTemplate>

				<div class="row">
					<div class="col-md-9">
						<div class="form-group">
							<ControlLabel ControlID="ServiceFolderTreeIdent" />
							<Control ID="ServiceFolderTreeIdent" />
						</div>
					</div>
					<div class="col-md-3">
						<div class="form-group">
							<ControlLabel ControlID="ServicePrice" />
							<Control ID="ServicePrice" />
						</div>
					</div>
				</div>

			</HTMLTemplate>
		</Section>
	</Sections>
</Form>
